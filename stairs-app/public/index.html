<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STAIRS - Accueil</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#0d1b2a,#1b263b);
      color:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:20px;
      margin:0;
    }
    h1 {
      font-size:2.5em;
      margin-bottom:.5em;
      text-align:center;
    }
    p {
      max-width:600px;
      line-height:1.5em;
      opacity:.9;
      text-align:center;
    }
    .buttons {
      margin:2em 0;
    }
    a {
      text-decoration:none;
      color:#fff;
      background:#1e90ff;
      padding:10px 20px;
      border-radius:8px;
      margin:0 10px;
      transition:background .2s;
    }
    a:hover { background:#63b3ed; }
    h2 {
      margin-top:2em;
      text-align:center;
      color:#f0f0f0;
    }
    #public-pages {
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:20px;
      margin-top:1em;
      width:100%;
      max-width:1000px;
    }
    .page-card {
      background:#1b263b;
      color:#fff;
      border-radius:8px;
      padding:15px;
      width:250px;
      box-shadow:0 4px 8px rgba(0,0,0,.3);
      transition:transform .2s;
      cursor:pointer;
    }
    .page-card:hover { transform:translateY(-5px); }
    .page-card img {
      max-width:100%;
      border-radius:5px;
      margin-bottom:10px;
    }
    .page-card h3 { margin:0 0 10px 0; font-size:1.2em; }
    .page-card p {
      font-size:.95em;
      line-height:1.2em;
      max-height:6em;
      overflow:hidden;
    }
    .page-card small { opacity:.7; display:block; margin-top:5px; }
  </style>
</head>
<body>

  <!-- Header inject√© dynamiquement -->
  <script src="header.js" defer></script>

  <h1>Bienvenue sur <strong>STAIRS</strong></h1>
  <p>Une application moderne pour explorer, cr√©er et partager vos contenus. Connectez-vous ou cr√©ez un compte pour g√©rer vos pages, ou parcourez les pages publiques ci-dessous.</p>

  <div class="buttons" id="auth-buttons">
    <a href="login.html" id="login-link">Se connecter</a>
    <a href="register.html" id="register-link">Cr√©er un compte</a>
  </div>

  <h2>üåê Pages publiques</h2>
  <div id="public-pages">Chargement...</div>

  <script>
    async function loadPublicPages() {
      const container = document.getElementById('public-pages');
      try {
        const res = await fetch('/pages/public');
        if (!res.ok) {
          container.innerHTML = '<p>Impossible de charger les pages publiques.</p>';
          return;
        }
        const pages = await res.json();
        if (!pages || pages.length === 0) {
          container.innerHTML = '<p>Aucune page publique pour le moment.</p>';
          return;
        }

        container.innerHTML = '';
        pages.forEach(p => {
          const div = document.createElement('div');
          div.className = 'page-card';
          const preview = (p.content || '').length > 200 ? (p.content || '').slice(0,200) + '‚Ä¶' : (p.content || '');
          div.innerHTML = `
            ${p.image ? `<img src="${p.image}" alt="${p.title || 'image'}">` : ''}
            <h3>${p.title || '(sans titre)'}</h3>
            <p>${preview}</p>
            <small>Publi√© par : ${p.id_user}</small>
          `;
          if (p.slug) {
            div.onclick = () => window.location.href = `public-page.html?slug=${encodeURIComponent(p.slug)}`;
          }

          container.appendChild(div);
        });
      } catch (err) {
        console.error('Erreur chargement pages publiques:', err);
        container.innerHTML = '<p>Erreur r√©seau lors du chargement.</p>';
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadPublicPages();

      const authButtons = document.getElementById('auth-buttons');
      const user = JSON.parse(localStorage.getItem('user'));
      if (user) {
        authButtons.innerHTML = `
          <a href="${user.role === 'admin' ? 'admin.html' : 'user.html'}">Mon espace</a>
          <a href="#" id="logout-link">Se d√©connecter</a>
        `;
        document.getElementById('logout-link').addEventListener('click', () => {
          localStorage.removeItem('user');
          window.location.reload();
        });
      }
    });
  </script>

</body>
</html>
