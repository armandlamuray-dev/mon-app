<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Administration</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fb; }
    section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    input, button { margin: 5px 0; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #4caf50; color: white; cursor: pointer; }
    button:hover { background: #45a049; }
    #page-details, #user-details { margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 6px; }
  </style>
</head>
<body>
  <script src="header.js" defer></script>

  <h1>ğŸ› ï¸ Panneau dâ€™administration</h1>

  <section>
    <h2>ğŸ” GÃ©rer une page</h2>
    <input type="text" id="id" placeholder="ID de la page" />
    <button id="view-page-btn">Afficher</button>
    <button id="delete-page-btn">Supprimer</button>
    <div id="page-details">DÃ©tails de la page apparaÃ®tront ici.</div>
  </section>

  <section>
    <h2>ğŸ‘¥ GÃ©rer un utilisateur</h2>
    <input type="text" id="userToDelete" placeholder="Nom d'utilisateur" />
    <button id="view-user-btn">Afficher</button>
    <button id="delete-user-btn">Supprimer</button>
    <div id="user-details">DÃ©tails de l'utilisateur apparaÃ®tront ici.</div>
  </section>

  <script>
    // Fonctions utilitaires pour fetch
    async function fetchJSON(url, options) {
      try {
        const res = await fetch(url, options);
        const data = await res.json().catch(() => null);
        if (!res.ok) throw data || { message: 'Erreur serveur' };
        return data;
      } catch (err) {
        console.error(err);
        alert(err.message || 'Erreur rÃ©seau');
        return null;
      }
    }

    // Page
    document.getElementById('view-page-btn').addEventListener('click', async () => {
      const id = document.getElementById('id').value.trim();
      if (!id) return alert('Veuillez entrer lâ€™ID de la page.');
      const data = await fetchJSON(`/pages/public/${encodeURIComponent(id)}`);
      const details = document.getElementById('page-details');
      if (!data) return details.innerHTML = 'Page non trouvÃ©e.';
      details.innerHTML = `
        <strong>Titre :</strong> ${data.title || '(sans titre)'}<br>
        <strong>Auteur :</strong> ${data.username}<br>
        <strong>Publique :</strong> ${data.public ? 'Oui' : 'Non'}<br>
        <strong>Nb sous-pages :</strong> ${data.subpages?.length || 0}
      `;
    });

    document.getElementById('delete-page-btn').addEventListener('click', async () => {
      const id = document.getElementById('id').value.trim();
      if (!id) return alert('Veuillez entrer lâ€™ID de la page.');
      if (!confirm('Voulez-vous vraiment supprimer cette page ?')) return;
      const data = await fetchJSON(`/admin/delete-page/${encodeURIComponent(id)}`, { method: 'DELETE' });
      alert(data?.message || 'Page supprimÃ©e.');
      document.getElementById('page-details').innerHTML = '';
    });

    // Utilisateur
    document.getElementById('view-user-btn').addEventListener('click', async () => {
      const username = document.getElementById('userToDelete').value.trim();
      if (!username) return alert('Veuillez entrer le nom dâ€™utilisateur.');
      const data = await fetchJSON(`/admin/user/${encodeURIComponent(username)}`);
      const details = document.getElementById('user-details');
      if (!data) return details.innerHTML = 'Utilisateur non trouvÃ©.';
      details.innerHTML = `
        <strong>Nom :</strong> ${data.username}<br>
        <strong>Email :</strong> ${data.email}<br>
        <strong>RÃ´le :</strong> ${data.role}<br>
        <strong>CrÃ©Ã© le :</strong> ${new Date(data.created_at).toLocaleString()}
      `;
    });

    document.getElementById('delete-user-btn').addEventListener('click', async () => {
      const username = document.getElementById('userToDelete').value.trim();
      if (!username) return alert('Veuillez entrer le nom dâ€™utilisateur.');
      if (!confirm('Voulez-vous vraiment supprimer cet utilisateur ?')) return;
      const data = await fetchJSON(`/admin/delete-user/${encodeURIComponent(username)}`, { method: 'DELETE' });
      alert(data?.message || 'Utilisateur supprimÃ©.');
      document.getElementById('user-details').innerHTML = '';
    });
  </script>
</body>
</html>
